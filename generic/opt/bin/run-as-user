#!/bin/sh -u


# run as root
if [ 0 -eq "$PUID" ] || [ 0 -eq "$PGID" ]; then
	exec "$@"
fi


# configure normal user
export HOME="$HOME/$PUSER"
addgroup --quiet "$PGROUP" --gid "$PGID"
adduser --quiet "$PUSER" --uid "$PUID" --gid "$PGID" --gecos "" --home "$HOME" --disabled-password
chown --recursive "$PUID:$PGID" "$HOME"


# run as normal user
exec sudo -u "#$PUID" -g "#$PGID" -D "$HOME" --non-interactive --preserve-env "$@"
